<header class="page-header full-with" [formGroup]="form">
  <mat-form-field class="pagetitle-input" floatLabel="never">
    <input type="text" matInput formControlName="name" [placeholder]="'ENTER_TITLE_HERE' | translate">
    <mat-error *ngIf="name.hasError('required')">{{'ERROR_REQUIRED' | translate}}</mat-error>
    <mat-error *ngIf="name.hasError('minlength')">{{'ERROR_MIN_LENGTH' | translate}} 1</mat-error>
    <mat-error *ngIf="name.hasError('maxlength')">{{'ERROR_MAX_LENGTH' | translate}} 60</mat-error>
  </mat-form-field>
  <!--  buttons-->
  <div class="btn-group">
    <cs-button classList="tertiary"
               *ngIf="!isEditPage"
               [disable]="loading"
               (click)="clickCancel()">
      {{'BTN_CANCEL' | translate}}
    </cs-button>
    <cs-button classList="tertiary"
               *ngIf="isEditPage"
               [disable]="loading"
               (click)="clickBack()">
      {{'BTN_BACK' | translate}}
    </cs-button>
    <cs-button classList="secondary"
               *ngIf="!isLastStep && showDraftButton"
               [disable]="loading"
               (click)="clickSaveAsDraft()">
      {{'BTN_SAVE_AS_DRAFT' | translate}}
    </cs-button>
    <cs-button classList="primary cs-btn-mobile"
               *ngIf="!isLastStep"
               [disable]="loading"
               (click)="clickGoNext()">
      <i class="cs-btn-mobile-icon icon next-icon"></i>
      {{'BTN_NEXT' | translate}}
    </cs-button>
    <cs-button *ngIf="isLastStep"
               classList="primary cs-btn-mobile"
               [disable]="loading"
               (click)="clickLaunch()">
      <i class="cs-btn-mobile-icon icon save-icon"></i>
      {{'BTN_LAUNCH' | translate}}
    </cs-button>
  </div>
  <!--/  buttons-->
</header>

<section class="content form-limiter loyalty">
  <div class="loyalty-loader">
    <mat-progress-bar class="loyalty-loader-bar" *ngIf="loading" mode="indeterminate"></mat-progress-bar>
  </div>
  <cs-horizontal-stepper  labelPosition="bottom"
                          #stepper
                          linear
                          [disable]="loading"
                          (beforeSelectionChange)="clickStepLabel($event)"
                          [selectedIndex]="0">
    <!--step 1-->
    <cs-step>
      <ng-template csStepLabel>{{'LOYALTY_FEATURE.LOYALTY_DETAILS' | translate}}</ng-template>
      <cl-loyalty-form-step-details *ngIf="form && firstStepForm" [group]="firstStepForm"
                                    [config]="manageConfig">
      </cl-loyalty-form-step-details>
    </cs-step>
    <!--step 2-->
    <cs-step>
      <ng-template csStepLabel>{{'LOYALTY_FEATURE.TIERS_CONVERSIONS' | translate}}</ng-template>
      <cl-loyalty-form-step-tiers-conversions *ngIf="stepProgress >= 1"
                                              [group]="secondStepForm"
                                              [customTierDataSource]="customTierDataSource"
                                              (tiersConversionsAction)="handleLoyaltyActions($event)"
                                              [config]="manageConfig">

      </cl-loyalty-form-step-tiers-conversions>
    </cs-step>
    <!--step 3-->
    <cs-step>
      <ng-template csStepLabel>{{'LOYALTY_FEATURE.POINT_EARN_RULES' | translate}}</ng-template>
      <cl-loyalty-form-step-earn-rules *ngIf="stepProgress >= 2"
                                       [config]="manageConfig"
                                       [basicTierId]="basicTierId"
                                       [basicTierRuleSet]="basicTierRuleSet"
                                       [customTierRuleSetMap]="customTierRuleSetMap"
                                       [customTierDataSource]="customTierDataSource"
                                       (rulesAction)="handleLoyaltyActions($event)"></cl-loyalty-form-step-earn-rules>
      <div>
      </div>
    </cs-step>
    <!--step 4-->
    <cs-step>
      <ng-template csStepLabel>{{'LOYALTY_FEATURE.REVIEW' | translate}}</ng-template>
      <cl-view-loyalty *ngIf="stepProgress >= 3"
                       [config]="viewConfig"
                       [loyaltyData]="form.value"
                       [dataSource]="customTierDataSource"
                       [basicTierRuleSet]="basicTierRuleSet"
                       [customTierRuleSetMap]="customTierRuleSetMap"
      ></cl-view-loyalty>
    </cs-step>
  </cs-horizontal-stepper>
</section>

